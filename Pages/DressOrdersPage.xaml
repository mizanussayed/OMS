<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:OMS.Components"
    x:Class="OMS.Pages.DressOrdersPage"
    Title="Orders"
    BackgroundColor="{StaticResource Gray50}">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Gradient Header Component -->
        <components:GradientHeader Grid.Row="0"
                                  Title="Dress Orders"
                                  TitleAlignment="Start"
                                  ActionButtonText="+ New"
                                  ShowActionButton="True"
                                  ActionButtonCommand="{Binding ShowNewOrderCommand}"/>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="12">
                <CollectionView ItemsSource="{Binding Orders}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="16" 
                                    StrokeThickness="1"
                                    Stroke="{StaticResource Gray100}"
                                    BackgroundColor="{StaticResource White}"
                                    Margin="0,0,0,12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray900}"
                                            Opacity="0.1"
                                            Radius="8"
                                            Offset="0,2" />
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="12">
                                    <!-- Header -->
                                    <Grid ColumnDefinitions="*,Auto">
                                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding CustomerName}" 
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                            <Label Text="{Binding DressType}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                        </VerticalStackLayout>
                                        <!-- Status Badge Component -->
                                        <Border Grid.Column="1" 
                                                Padding="8,4" 
                                                StrokeThickness="1"
                                                Stroke="{Binding StatusBorderColor}"
                                                BackgroundColor="{Binding StatusBackgroundColor}"
                                                VerticalOptions="Start">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12" />
                                            </Border.StrokeShape>
                                            <Label Text="{Binding StatusText}" 
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding StatusTextColor}"/>
                                        </Border>
                                    </Grid>

                                    <!-- Order Details -->
                                    <VerticalStackLayout Spacing="8">
                                        <!-- Cloth Info -->
                                        <HorizontalStackLayout Spacing="8">
                                            <BoxView WidthRequest="12" 
                                                     HeightRequest="12" 
                                                     CornerRadius="6"
                                                     BackgroundColor="{Binding ClothColor, Converter={StaticResource ColorConverter}}"
                                                     VerticalOptions="Center"/>
                                            <Label FontSize="14" TextColor="{StaticResource Gray600}">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="{Binding ClothName}"/>
                                                        <Span Text=" - "/>
                                                        <Span Text="{Binding ClothColor}"/>
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </HorizontalStackLayout>

                                        <!-- Assigned To (if available) -->
                                        <Grid ColumnDefinitions="*,Auto" IsVisible="{Binding HasAssignedTo}">
                                            <Label Grid.Column="0" 
                                                   Text="Assigned to:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding AssignedToName}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>

                                        <!-- Fabric Used -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Fabric Used:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding MetersUsed, StringFormat='{0}m'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>

                                        <!-- Cost -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Cost:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding TotalCost, StringFormat='₹{0:N0}'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>

                                        <!-- Order Date -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Order Date:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding OrderDate, StringFormat='{0:MM/dd/yyyy}'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                    <!-- Action Buttons -->
                                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Gray100}"/>
                                    <Grid ColumnDefinitions="*" ColumnSpacing="8">
                                        <!-- Complete Button (for Pending orders) -->
                                        <Button Grid.Column="0"
                                                Text="✓ Complete" 
                                                FontSize="14"
                                                FontAttributes="Bold"
                                                TextColor="{StaticResource Gray700}"
                                                BackgroundColor="{StaticResource White}"
                                                BorderColor="{StaticResource Gray300}"
                                                BorderWidth="1"
                                                Command="{Binding CompleteCommand}"
                                                IsVisible="{Binding IsPending}"
                                                CornerRadius="8"
                                                Padding="12,8"/>

                                        <!-- Deliver Button (for Completed orders) -->
                                        <Button Grid.Column="0"
                                                Text="🚚 Deliver" 
                                                FontSize="14"
                                                FontAttributes="Bold"
                                                TextColor="{StaticResource Gray700}"
                                                BackgroundColor="{StaticResource White}"
                                                BorderColor="{StaticResource Gray300}"
                                                BorderWidth="1"
                                                Command="{Binding DeliverCommand}"
                                                IsVisible="{Binding IsCompleted}"
                                                CornerRadius="8"
                                                Padding="12,8"/>

                                        <!-- Completed Message (for Delivered orders) -->
                                        <Label Grid.Column="0"
                                               Text="✓ Order Completed" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Green600}"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               IsVisible="{Binding IsDelivered}"
                                               Padding="12,8"/>
                                    </Grid>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Empty State -->
                <Border Padding="32" 
                        StrokeThickness="1"
                        Stroke="{StaticResource Gray100}"
                        BackgroundColor="{StaticResource White}"
                        IsVisible="{Binding HasNoOrders}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray900}"
                                Opacity="0.1"
                                Radius="8"
                                Offset="0,2" />
                    </Border.Shadow>
                    <Label Text="No orders yet. Create your first order!" 
                           FontSize="16"
                           TextColor="{StaticResource Gray500}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
