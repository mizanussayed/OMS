<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:OMS.Components"
    x:Class="OMS.Pages.DashboardPage"
    Title="Dashboard"
    BackgroundColor="{StaticResource Gray50}">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Gradient Header Component -->
        <components:GradientHeader Grid.Row="0"
                                  Title="Cloth Shop Manager"
                                  Subtitle="{Binding UserRoleDescription}"
                                  TitleAlignment="Center"
                                  ActionButtonText="Logout"
                                  ActionButtonFontSize="12"
                                  ShowActionButton="True"
                                  ActionButtonCommand="{Binding LogoutCommand}"/>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="16">
                <!-- Stats Cards using reusable component -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                    <components:StatsCard Grid.Row="0" Grid.Column="0"
                                        Icon="&#x1F4E6;"
                                        IconBackgroundColor="{StaticResource Blue100}"
                                        Label="Total Cloths"
                                        Value="{Binding TotalCloths}"/>

                    <components:StatsCard Grid.Row="0" Grid.Column="1"
                                        Icon="&#x1F6CD;"
                                        IconBackgroundColor="{StaticResource Purple100}"
                                        Label="Pending Orders"
                                        Value="{Binding PendingOrders}"/>

                    <components:StatsCard Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                        Icon="&#x1F4C8;"
                                        IconBackgroundColor="{StaticResource Green100}"
                                        Label="Inventory Value"
                                        Value="{Binding InventoryValue, StringFormat='₹{0:N0}'}"/>
                </Grid>

                <!-- Low Stock Alert -->
                <Border Padding="16" 
                        StrokeThickness="1"
                        Stroke="{StaticResource Orange200}"
                        BackgroundColor="{StaticResource Orange50}" 
                        IsVisible="{Binding HasLowStockItems}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="&#x26A0;" 
                                   FontSize="20" 
                                   TextColor="{StaticResource Orange600}"/>
                            <Label Text="Low Stock Alert" 
                                   FontSize="16"
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource Orange900}"/>
                        </HorizontalStackLayout>
                        
                        <CollectionView ItemsSource="{Binding LowStockCloths}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,Auto" Padding="0,4">
                                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                                            <Label Text="{Binding Name}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray900}"/>
                                            <Label Text="{Binding Color}" 
                                                   FontSize="12"
                                                   TextColor="{StaticResource Gray600}"/>
                                        </VerticalStackLayout>
                                        <Label Grid.Column="1" 
                                               Text="{Binding RemainingMeters, StringFormat='{0}m remaining'}" 
                                               FontSize="14"
                                               TextColor="{StaticResource Orange600}"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <!-- Cloth Inventory -->
                <Border Padding="0" 
                        StrokeThickness="1"
                        Stroke="{StaticResource Gray100}"
                        BackgroundColor="{StaticResource White}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray900}"
                                Opacity="0.1"
                                Radius="8"
                                Offset="0,2" />
                    </Border.Shadow>
                    <VerticalStackLayout>
                        <Label Text="Cloth Inventory" 
                               FontSize="18"
                               FontAttributes="Bold" 
                               TextColor="{StaticResource Gray900}"
                               Padding="16,16,16,12"/>
                        
                        <BoxView HeightRequest="1" 
                                 BackgroundColor="{StaticResource Gray100}"/>

                        <CollectionView ItemsSource="{Binding Cloths}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="16" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8">
                                        <BoxView Grid.Row="0" 
                                                 HeightRequest="1" 
                                                 BackgroundColor="{StaticResource Gray100}"
                                                 VerticalOptions="Start"/>
                                        
                                        <!-- Header -->
                                        <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
                                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                                <Label Text="{Binding Name}" 
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       TextColor="{StaticResource Gray900}"/>
                                                <Label Text="{Binding Color}" 
                                                       FontSize="14"
                                                       TextColor="{StaticResource Gray600}"/>
                                            </VerticalStackLayout>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding PricePerMeter, StringFormat='₹{0}/m'}" 
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"
                                                   VerticalOptions="Start"/>
                                        </Grid>

                                        <!-- Meters Info -->
                                        <Grid Grid.Row="2" ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="{Binding RemainingMeters, StringFormat='{0}m'}"/>
                                                        <Span Text=" / "/>
                                                        <Span Text="{Binding TotalMeters, StringFormat='{0}m'}"/>
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding UsagePercent, StringFormat='{0:F0}% used'}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                        </Grid>

                                        <!-- Progress Bar using component -->
                                        <components:GradientProgressBar Grid.Row="3"
                                                                       Progress="{Binding ProgressWidth}"
                                                                       MaxWidth="300"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
