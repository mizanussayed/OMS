<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:OMS.Components"
    xmlns:vm="clr-namespace:OMS.ViewModels"
    x:DataType="vm:DashboardViewModel"
    x:Class="OMS.Pages.DashboardPage"
    Title="Dashboard"
    BackgroundColor="{StaticResource Gray50}"
    Shell.NavBarIsVisible="False">
    
    <Grid RowDefinitions="Auto,*">
        <components:GradientHeader Grid.Row="0"
                                  Title="Cloth Shop Manager"
                                  Subtitle="{Binding UserRoleDescription}"
                                  ActionButtonIcon="icon_logout.svg"
                                  ActionButtonText="Logout"
                                  ShowActionButton="True"
                                  ActionButtonCommand="{Binding LogoutCommand}"/>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="16">
                <!-- Stats Cards Grid -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                    <!-- Total Cloths -->
                    <Border Grid.Row="0" Grid.Column="0"
                            Padding="16"
                            StrokeThickness="0"
                            BackgroundColor="{StaticResource White}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="{StaticResource Gray900}"
                                    Opacity="0.08"
                                    Radius="10"
                                    Offset="0,2" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="8">
                            <Border WidthRequest="40"
                                    HeightRequest="40"
                                    BackgroundColor="{StaticResource Blue50}"
                                    StrokeThickness="0"
                                    HorizontalOptions="Start">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Label Text="ðŸ“¦"
                                       FontSize="20"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Border>
                            <Label Text="Total Cloths"
                                   FontSize="12"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding TotalCloths}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Gray900}"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Pending Orders -->
                    <Border Grid.Row="0" Grid.Column="1"
                            Padding="16"
                            StrokeThickness="0"
                            BackgroundColor="{StaticResource White}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="{StaticResource Gray900}"
                                    Opacity="0.08"
                                    Radius="10"
                                    Offset="0,2" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="8">
                            <Border WidthRequest="40"
                                    HeightRequest="40"
                                    BackgroundColor="{StaticResource Purple100}"
                                    StrokeThickness="0"
                                    HorizontalOptions="Start">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Label Text="ðŸ›’"
                                       FontSize="20"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Border>
                            <Label Text="Pending Orders"
                                   FontSize="12"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding PendingOrders}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Gray900}"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Inventory Value - Full Width -->
                    <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                            Padding="16"
                            StrokeThickness="0"
                            BackgroundColor="{StaticResource White}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="{StaticResource Gray900}"
                                    Opacity="0.08"
                                    Radius="10"
                                    Offset="0,2" />
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="8">
                            <Border WidthRequest="40"
                                    HeightRequest="40"
                                    BackgroundColor="{StaticResource Green50}"
                                    StrokeThickness="0"
                                    HorizontalOptions="Start">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Label Text="ðŸ“ˆ"
                                       FontSize="20"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Border>
                            <Label Text="Inventory Value"
                                   FontSize="12"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding InventoryValue, StringFormat='à§³{0:N0}'}"
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Gray900}"/>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <!-- Add Maker Button -->
                <components:ActionButton Text="Add New Maker"
                                        Command="{Binding AddMakerCommand}"
                                        Variant="Primary"
                                        HorizontalOptions="Fill"/>

                <!-- Cloth Inventory Section -->
                <Label Text="Cloth Inventory" 
                       FontSize="16"
                       FontAttributes="Bold" 
                       TextColor="{StaticResource Gray900}"
                       Margin="0,8,0,0"/>

                <!-- Cloth Inventory List -->
                <CollectionView ItemsSource="{Binding Cloths}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="vm:ClothViewModel">
                            <Border Padding="16" 
                                    StrokeThickness="0"
                                    BackgroundColor="{StaticResource White}"
                                    Margin="0,0,0,12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray900}"
                                            Opacity="0.08"
                                            Radius="10"
                                            Offset="0,2" />
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="10">
                                    <!-- Header with Name and Price -->
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               Text="{Binding Name}" 
                                               FontSize="15"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}"/>
                                        <Label Grid.Column="1"
                                               Text="{Binding PricePerMeter, StringFormat='à§³{0}/m'}" 
                                               FontSize="15"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}"
                                               HorizontalOptions="End"/>
                                    </Grid>

                                    <!-- Color -->
                                    <Label Text="{Binding Color}" 
                                           FontSize="13"
                                           TextColor="{StaticResource Gray600}"/>

                                    <!-- Stock Info -->
                                    <Grid ColumnDefinitions="*,Auto">
                                        <Label Grid.Column="0"
                                               FontSize="13"
                                               TextColor="{StaticResource Gray600}">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding RemainingMeters, StringFormat='{0}m'}"/>
                                                    <Span Text=" / "/>
                                                    <Span Text="{Binding TotalMeters, StringFormat='{0}m'}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                        <Label Grid.Column="1"
                                               Text="{Binding UsagePercent, StringFormat='{0:F0}% used'}" 
                                               FontSize="13"
                                               TextColor="{StaticResource Gray600}"/>
                                    </Grid>

                                    <!-- Progress Bar -->
                                    <Border HeightRequest="6"
                                            BackgroundColor="{StaticResource Gray200}"
                                            StrokeThickness="0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="3" />
                                        </Border.StrokeShape>
                                        <Border WidthRequest="{Binding ProgressWidth}"
                                                HeightRequest="6"
                                                BackgroundColor="{Binding ProgressColor}"
                                                HorizontalOptions="Start"
                                                StrokeThickness="0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="3" />
                                            </Border.StrokeShape>
                                        </Border>
                                    </Border>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
