<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:OMS.Components"
    x:Class="OMS.Pages.MakerWorkspacePage"
    Title="My Orders"
    BackgroundColor="{StaticResource Gray50}">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Gradient Header Component -->
        <components:GradientHeader Grid.Row="0"
                                  Title="My Workspace"
                                  Subtitle="{Binding MakerName}"
                                  TitleAlignment="Center"
                                  ActionButtonText="Logout"
                                  ActionButtonFontSize="12"
                                  ShowActionButton="True"
                                  ActionButtonCommand="{Binding LogoutCommand}"/>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="16">
                <!-- Stats Card -->
                <Border Padding="16" 
                        StrokeThickness="1"
                        Stroke="{StaticResource Gray100}"
                        BackgroundColor="{StaticResource White}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray900}"
                                Opacity="0.1"
                                Radius="8"
                                Offset="0,2" />
                    </Border.Shadow>
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Assigned Orders" 
                                   FontSize="12"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding TotalOrders}" 
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Purple600}"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="Pending" 
                                   FontSize="12"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding PendingOrders}" 
                                   FontSize="24"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Yellow600}"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- Orders List -->
                <Label Text="Your Orders" 
                       FontSize="18"
                       FontAttributes="Bold" 
                       TextColor="{StaticResource Gray900}"/>

                <!-- Empty State -->
                <components:EmptyState Icon="&#x1F4CB;"
                                      Title="No Orders Assigned"
                                      Message="You don't have any orders assigned yet. Please contact your admin."
                                      IsVisible="{Binding HasNoOrders}"/>

                <!-- Orders Collection -->
                <CollectionView ItemsSource="{Binding Orders}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="16" 
                                    StrokeThickness="1"
                                    Stroke="{StaticResource Gray100}"
                                    BackgroundColor="{StaticResource White}"
                                    Margin="0,0,0,12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray900}"
                                            Opacity="0.1"
                                            Radius="8"
                                            Offset="0,2" />
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="12">
                                    <!-- Header -->
                                    <Grid ColumnDefinitions="*,Auto">
                                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding CustomerName}" 
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                            <Label Text="{Binding DressType}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                        </VerticalStackLayout>
                                        <!-- Status Badge -->
                                        <Border Grid.Column="1" 
                                                Padding="8,4" 
                                                StrokeThickness="1"
                                                Stroke="{Binding StatusBorderColor}"
                                                BackgroundColor="{Binding StatusBackgroundColor}"
                                                VerticalOptions="Start">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12" />
                                            </Border.StrokeShape>
                                            <Label Text="{Binding StatusText}" 
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding StatusTextColor}"/>
                                        </Border>
                                    </Grid>

                                    <!-- Order Details -->
                                    <VerticalStackLayout Spacing="8">
                                        <!-- Cloth Info -->
                                        <HorizontalStackLayout Spacing="8">
                                            <BoxView WidthRequest="12" 
                                                     HeightRequest="12" 
                                                     CornerRadius="6"
                                                     BackgroundColor="{Binding ClothColor, Converter={StaticResource ColorConverter}}"
                                                     VerticalOptions="Center"/>
                                            <Label FontSize="14" TextColor="{StaticResource Gray600}">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="{Binding ClothName}"/>
                                                        <Span Text=" - "/>
                                                        <Span Text="{Binding ClothColor}"/>
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </HorizontalStackLayout>

                                        <!-- Fabric Used -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Fabric Used:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding MetersUsed, StringFormat='{0}m'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>

                                        <!-- Order Date -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Order Date:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding OrderDate, StringFormat='{0:MM/dd/yyyy}'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                    <!-- Action Buttons -->
                                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Gray100}"/>
                                    <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                                        <!-- Complete Button (for Pending orders) -->
                                        <components:ActionButton Grid.Column="0"
                                                                Text="âœ“ Complete" 
                                                                Variant="Success"
                                                                Command="{Binding CompleteCommand}"
                                                                IsVisible="{Binding IsPending}"/>

                                        <!-- Deliver Button (for Completed orders) -->
                                        <components:ActionButton Grid.Column="0" Grid.ColumnSpan="2"
                                                                Text="ðŸšš Mark as Delivered" 
                                                                Variant="Primary"
                                                                Command="{Binding DeliverCommand}"
                                                                IsVisible="{Binding IsCompleted}"/>

                                        <!-- Completed Message (for Delivered orders) -->
                                        <Label Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="âœ“ Order Delivered" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Green600}"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               IsVisible="{Binding IsDelivered}"
                                               Padding="12,8"/>
                                    </Grid>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
