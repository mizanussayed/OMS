<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:OMS.Components"
    xmlns:vm="clr-namespace:OMS.ViewModels"
    x:DataType="vm:MakerWorkspaceViewModel"
    x:Class="OMS.Pages.MakerWorkspacePage"
    NavigationPage.HasNavigationBar="False"
    Title="My Orders"
    BackgroundColor="{StaticResource Gray50}">

    <Grid RowDefinitions="Auto,*">
        <components:GradientHeader Grid.Row="0"
                                   Title="{Binding MakerName}"
                                   Subtitle="My Workspace"
                                   ActionButtonIcon="icon_logout.svg"
                                   ActionButtonText="Logout"
                                   ShowActionButton="True"
                                   ActionButtonCommand="{Binding LogoutCommand}"/>

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="16">
                <!-- Stats Card -->
                <Border Padding="16" 
                        StrokeThickness="1"
                        Stroke="{StaticResource Gray100}"
                        BackgroundColor="{StaticResource White}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="{StaticResource Gray900}"
                                Opacity="0.1"
                                Radius="8"
                                Offset="0,2" />
                    </Border.Shadow>
                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                            <Label Text="Total Orders" 
                                   FontSize="11"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding TotalOrders}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Purple600}"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1" Spacing="4">
                            <Label Text="Pending" 
                                   FontSize="11"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding PendingOrders}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Yellow600}"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="2" Spacing="4">
                            <Label Text="Completed" 
                                   FontSize="11"
                                   TextColor="{StaticResource Gray600}"/>
                            <Label Text="{Binding CompletedOrders}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource Blue600}"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- Filter Section -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Border Grid.Column="0"
                            Padding="1"
                            BackgroundColor="{StaticResource Gray50}"
                            StrokeThickness="1"
                            Stroke="{StaticResource Gray200}"
                            >
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8" />
                        </Border.StrokeShape>
                        <Picker ItemsSource="{Binding AvailableStatuses}"
                                SelectedItem="{Binding SelectedStatusFilterString}"
                                Title="Filter"
                                FontSize="13"
                                TextColor="{StaticResource Gray900}"
                                TitleColor="{StaticResource Gray600}"
                                BackgroundColor="Transparent"
                                WidthRequest="90"/>
                    </Border>
                    <Button Text="Clear Filter"
                        Grid.Column="1"
                        Command="{Binding ClearFiltersCommand}"
                        BackgroundColor="{StaticResource Gray100}"
                        TextColor="{StaticResource Gray700}"
                        BorderColor="{StaticResource Gray300}"
                        BorderWidth="1"
                        CornerRadius="8"
                        HeightRequest="36"
                        FontSize="13"
                        IsVisible="{Binding SelectedStatusFilterString, Converter={StaticResource StringIsNotNullOrEmptyConverter}}">
                        <Button.Triggers>
                            <DataTrigger TargetType="Button"
                                    Binding="{Binding SelectedStatusFilterString}"
                                    Value="All">
                                <Setter Property="IsVisible" Value="False" />
                            </DataTrigger>
                        </Button.Triggers>
                    </Button>
                </Grid>
                <!-- Orders Collection -->
                <CollectionView ItemsSource="{Binding Orders}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="vm:DressOrderItemViewModel">
                            <Border Padding="16" 
                                    StrokeThickness="1"
                                    Stroke="{StaticResource Gray100}"
                                    BackgroundColor="{StaticResource White}"
                                    Margin="0,0,0,12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="{StaticResource Gray900}"
                                            Opacity="0.1"
                                            Radius="8"
                                            Offset="0,2" />
                                </Border.Shadow>
                                <VerticalStackLayout Spacing="12">
                                    <!-- Header -->
                                    <Grid ColumnDefinitions="*,Auto">
                                        <VerticalStackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding CustomerName}" 
                                                   FontSize="18"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                            <Label Text="{Binding DressType}" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                        </VerticalStackLayout>
                                        <!-- Status Badge -->
                                        <Border Grid.Column="1" 
                                                Padding="8,4" 
                                                StrokeThickness="1"
                                                Stroke="{Binding StatusBorderColor}"
                                                BackgroundColor="{Binding StatusBackgroundColor}"
                                                VerticalOptions="Start">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="12" />
                                            </Border.StrokeShape>
                                            <Label Text="{Binding StatusText}" 
                                                   FontSize="12"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding StatusTextColor}"/>
                                        </Border>
                                    </Grid>

                                    <!-- Order Details -->
                                    <VerticalStackLayout Spacing="8">
                                        <!-- Cloth Info -->
                                        <HorizontalStackLayout Spacing="8">
                                            <BoxView WidthRequest="12" 
                                                     HeightRequest="12" 
                                                     CornerRadius="6"
                                                     BackgroundColor="{Binding ClothColor, Converter={StaticResource ColorConverter}}"
                                                     VerticalOptions="Center"/>
                                            <Label FontSize="14" TextColor="{StaticResource Gray600}">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="{Binding ClothName}"/>
                                                        <Span Text=" - "/>
                                                        <Span Text="{Binding ClothColor}"/>
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </HorizontalStackLayout>

                                        <!-- Fabric Used -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Fabric Used:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding MetersUsed, StringFormat='{0}m'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>

                                        <!-- Order Date -->
                                        <Grid ColumnDefinitions="*,Auto">
                                            <Label Grid.Column="0" 
                                                   Text="Order Date:" 
                                                   FontSize="14"
                                                   TextColor="{StaticResource Gray600}"/>
                                            <Label Grid.Column="1" 
                                                   Text="{Binding OrderDate, StringFormat='{0:MM/dd/yyyy}'}" 
                                                   FontSize="14"
                                                   FontAttributes="Bold"
                                                   TextColor="{StaticResource Gray900}"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                    <!-- Action Buttons -->
                                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Gray100}"/>
                                    <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                                        <!-- Complete Button (for Pending orders) -->
                                        <components:ActionButton Grid.Column="0"
                                                                Text="âœ“ Complete" 
                                                                Variant="Success"
                                                                Command="{Binding CompleteCommand}"
                                                                IsVisible="{Binding IsPending}"/>

                                        <!-- Deliver Button (for Completed orders) -->
                                        <components:ActionButton Grid.Column="0" Grid.ColumnSpan="2"
                                                                Text="ðŸšš Mark as Delivered" 
                                                                Variant="Primary"
                                                                Command="{Binding DeliverCommand}"
                                                                IsVisible="{Binding IsCompleted}"/>

                                        <!-- Completed Message (for Delivered orders) -->
                                        <Label Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="âœ“ Order Delivered" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Green600}"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"
                                               IsVisible="{Binding IsDelivered}"
                                               Padding="12,8"/>
                                    </Grid>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <Label Text="No order found!" 
                               FontSize="16"
                               TextColor="{StaticResource Gray600}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </CollectionView.EmptyView>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>
