<?xml version="1.0" encoding="utf-8"?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:OMS.Components"
    xmlns:vm="clr-namespace:OMS.ViewModels"
    x:DataType="vm:AddClothViewModel"
    x:Class="OMS.Pages.AddClothDialog"
    BackgroundColor="#80000000">
    
    <!-- Semi-transparent overlay -->
    <Grid>
        <Grid.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding CloseCommand}"/>
        </Grid.GestureRecognizers>
        
        <!-- Bottom Sheet Dialog -->
        <Border BackgroundColor="White"
                StrokeThickness="0"
                VerticalOptions="End"
                HorizontalOptions="Fill"
                MaximumHeightRequest="600">
            <Border.GestureRecognizers>
                <TapGestureRecognizer />
            </Border.GestureRecognizers>
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="16,16,0,0" />
            </Border.StrokeShape>
            
            <Grid RowDefinitions="Auto,*,Auto" Padding="24">
                <!-- Header -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,4">
                    <VerticalStackLayout Grid.Column="0" Spacing="4">
                        <Label Text="{Binding PageTitle}" 
                               FontSize="20"
                               FontAttributes="Bold" 
                               TextColor="{StaticResource Gray900}"/>
                        <Label Text="Add or update cloth in your inventory with pricing and quantity details"
                               FontSize="14"
                               TextColor="{StaticResource Gray600}"
                               LineBreakMode="WordWrap"/>
                    </VerticalStackLayout>
                    <Button Grid.Column="1"
                            Text="✕"
                            Command="{Binding CloseCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource Gray600}"
                            FontSize="20"
                            Padding="0"
                            WidthRequest="32"
                            HeightRequest="32"
                            VerticalOptions="Start"/>
                </Grid>

                <!-- Form -->
                <ScrollView Grid.Row="1" Margin="0,20,0,0">
                    <VerticalStackLayout Spacing="16">
                        <!-- UniqueCode (Read-only, visible only in edit mode) -->
                        <Border Padding="12,10"
                                BackgroundColor="{StaticResource Gray100}"
                                StrokeThickness="1"
                                Stroke="{StaticResource Gray200}"
                                IsVisible="{Binding IsUniqueCodeVisible}">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="4">
                                <Label Text="Unique Code"
                                       FontSize="12"
                                       TextColor="{StaticResource Gray600}"/>
                                <Label Text="{Binding UniqueCode}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource Gray700}"/>
                            </VerticalStackLayout>
                        </Border>
                        
                        <!-- Cloth Name -->
                        <components:InputField Label="Cloth Name"
                                              Text="{Binding Name}"
                                              Placeholder="e.g., Cotton Premium"
                                              ErrorMessage="{Binding NameError}"/>

                        <!-- Color -->
                        <components:InputField Label="Color"
                                              Text="{Binding Color}"
                                              Placeholder="e.g., Blue, Red"
                                              ErrorMessage="{Binding ColorError}"/>

                        <!-- Row: Price and Total Meters -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <components:InputField Grid.Column="0"
                                                  Label="Price per Meter (৳)"
                                                  Text="{Binding PricePerMeter}"
                                                  Placeholder="450"
                                                  Keyboard="Numeric"
                                                  ErrorMessage="{Binding PriceError}"/>

                            <components:InputField Grid.Column="1"
                                                  Label="Total Meters"
                                                  Text="{Binding TotalMeters}"
                                                  Placeholder="50"
                                                  Keyboard="Numeric"
                                                  ErrorMessage="{Binding MetersError}"/>
                        </Grid>
                    </VerticalStackLayout>
                </ScrollView>

                <!-- Action Button -->
                <components:ActionButton Grid.Row="2"
                                        Text="{Binding SubmitButtonText}"
                                        Variant="Primary"
                                        Command="{Binding AddClothCommand}"
                                        Margin="0,20,0,0"/>
            </Grid>
        </Border>
    </Grid>
</ContentPage>
